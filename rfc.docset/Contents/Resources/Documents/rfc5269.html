<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="index,follow" name="robots"/>
<meta content="rfchandler version 0.2" name="creator"/>
<meta content="J. Kempf" name="citation_author"/>
<meta content="R. Koodli" name="citation_author"/>
<meta content="June, 2008" name="citation_publication_date"/>
<meta content="Distributing a Symmetric Fast Mobile IPv6 (FMIPv6) Handover Key Using SEcure Neighbor Discovery (SEND)" name="citation_title"/>
<meta content="10.17487/RFC5269" name="citation_doi"/>
<meta content="2070-1721" name="citation_issn"/>
<meta content="rfc5269" name="citation_technical_report_number"/>
<meta content="https://www.rfc-editor.org/rfc/pdfrfc/rfc5269.txt.pdf" name="citation_pdf_url"/>
<title>RFC 5269: Distributing a Symmetric Fast Mobile IPv6 (FMIPv6) Handover Key Using SEcure Neighbor Discovery (SEND)</title>
<style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
           /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
<!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]--> <script type="text/javascript"><!--
    function addHeaderTags() {
        var spans = document.getElementsByTagName("span");
        for (var i=0; i < spans.length; i++) {
            var elem = spans[i];
            if (elem) {
                var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";               
                }
            }
        }
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script></head>
<body>
<span class="pre noprint docinfo">[<a href="https://www.rfc-editor.org" title="RFC Editor">RFC Home</a>] [<a href="/rfc/rfc5269.txt">TEXT</a>|<a href="/rfc/pdfrfc/rfc5269.txt.pdf">PDF</a>|<a href="/rfc/rfc5269.html">HTML</a>] [<a href="https://datatracker.ietf.org/doc/rfc5269" title="IETF Datatracker information for this document">Tracker</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=5269&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>] [<a href="https://www.rfc-editor.org/info/rfc5269" title="Info page">Info page</a>]                  </span><br/><span class="pre noprint docinfo"> </span><br/><span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/><span class="pre noprint docinfo"> </span><pre>Network Working Group                                           J. Kempf
Request for Comments: 5269                               DoCoMo Labs USA
Category: Standards Track                                      R. Koodli
                                                        Starent Networks
                                                               June 2008


 <span class="h1">Distributing a Symmetric Fast Mobile IPv6 (FMIPv6) Handover Key Using</span>
                   <span class="h1">SEcure Neighbor Discovery (SEND)</span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Abstract

   Fast Mobile IPv6 requires that a Fast Binding Update is secured using
   a security association shared between an Access Router and a Mobile
   Node in order to avoid certain attacks.  In this document, a method
   for provisioning a shared key from the Access Router to the Mobile
   Node is defined to protect this signaling.  The Mobile Node generates
   a public/private key pair using the same public key algorithm as for
   SEND (<a href="./rfc3971.html">RFC 3971</a>).  The Mobile Node sends the public key to the Access
   Router.  The Access Router encrypts a shared handover key using the
   public key and sends it back to the Mobile Node.  The Mobile Node
   decrypts the shared handover key using the matching private key, and
   the handover key is then available for generating an authenticator on
   a Fast Binding Update.  The Mobile Node and Access Router use the
   Router Solicitation for Proxy Advertisement and Proxy Router
   Advertisement from Fast Mobile IPv6 for the key exchange.  The key
   exchange messages are required to have SEND security; that is, the
   source address is a Cryptographically Generated Address (CGA) and the
   messages are signed using the CGA private key of the sending node.
   This allows the Access Router, prior to providing the shared handover
   key, to verify the authorization of the Mobile Node to claim the
   address so that the previous care-of CGA in the Fast Binding Update
   can act as the name of the key.










<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
      <a href="#section-1.1">1.1</a>. Terminology ................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Overview of the Protocol ........................................<a href="#page-3">3</a>
      <a href="#section-2.1">2.1</a>. Brief Review of SEND .......................................<a href="#page-3">3</a>
      <a href="#section-2.2">2.2</a>. Protocol Overview ..........................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Handover Key Provisioning and Use ...............................<a href="#page-4">4</a>
      <a href="#section-3.1">3.1</a>. Sending Router Solicitations for Proxy Advertisement .......<a href="#page-4">4</a>
      3.2. Receiving Router Solicitations for Proxy
           Advertisement and Sending Proxy Router Advertisements ......<a href="#page-5">5</a>
      <a href="#section-3.3">3.3</a>. Receiving Proxy Router Advertisements ......................<a href="#page-6">6</a>
      <a href="#section-3.4">3.4</a>. Sending FBUs ...............................................<a href="#page-7">7</a>
      <a href="#section-3.5">3.5</a>. Receiving FBUs .............................................<a href="#page-7">7</a>
      <a href="#section-3.6">3.6</a>. Key Generation and Lifetime ................................<a href="#page-7">7</a>
      <a href="#section-3.7">3.7</a>. Protocol Constants .........................................<a href="#page-8">8</a>
   <a href="#section-4">4</a>. Message Formats .................................................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. Handover Key Request Option ................................<a href="#page-8">8</a>
      <a href="#section-4.2">4.2</a>. Handover Key Reply Option .................................<a href="#page-10">10</a>
   <a href="#section-5">5</a>. Security Considerations ........................................<a href="#page-11">11</a>
   <a href="#section-6">6</a>. IANA Considerations ............................................<a href="#page-11">11</a>
   <a href="#section-7">7</a>. References .....................................................<a href="#page-12">12</a>
      <a href="#section-7.1">7.1</a>. Normative References ......................................<a href="#page-12">12</a>
      <a href="#section-7.2">7.2</a>. Informative References ....................................<a href="#page-12">12</a>

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.%20%20Introduction"></a></body></html><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   In Fast Mobile IPv6 (FMIPv6) [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>], a Fast Binding Update (FBU) is
   sent from a Mobile Node (MN), undergoing IP handover, to the previous
   Access Router (AR).  The FBU causes a routing change so traffic sent
   to the MN's previous Care-of Address on the previous AR's link is
   tunneled to the new Care-of Address on the new AR's link.  Only an MN
   authorized to claim the address should be able to change the routing
   for the previous Care-of Address.  If such authorization is not
   established, an attacker can redirect a victim MN's traffic at will.

   In this document, a lightweight mechanism is defined by which a
   shared handover key for securing FMIP can be provisioned on the MN by
   the AR.  The mechanism utilizes SEND [<a href="#ref-SEND" title='"SEcure Neighbor Discovery (SEND)"'>SEND</a>] and an additional
   public/private key pair, generated on the MN using the same public
   key algorithm as SEND, to encrypt/decrypt a shared handover key sent
   from the AR to the MN.  The key provisioning occurs at some arbitrary
   time prior to handover, thereby relieving any performance overhead on
   the handover process.  The message exchange between the MN and AR to
   provision the handover key is required to be protected by SEND; that
   is, the source address for the key provisioning messages must be a
   CGA and the messages must be signed with the CGA private key.  This
   allows the AR to establish the MN's authorization to operate on the



<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


   CGA.  The AR uses the CGA to name the handover key.  The SEND key
   pair is, however, independent from the handover encryption/decryption
   key pair and from the actual handover key.  Once the shared handover
   key has been established, when the MN undergoes IP handover, the MN
   generates an authorization Message Authentication Code (MAC) on the
   FBU.  The previous care-of CGA included in the FBU is used by the AR
   to find the right handover key for checking the authorization.

   Handover keys are an instantiation of the purpose built key
   architectural principle [<a href="#ref-PBK" title='"A Framework for Purpose-Built Keys (PBK)"'>PBK</a>].

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.1.%20%20Terminology"></a></body></html><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Terminology</span>

   The key words "<em>MUST</em>", "<em>MUST NOT</em>", "<em>REQUIRED</em>", "<em>SHALL</em>", "<em>SHALL NOT</em>",
   "<em>SHOULD</em>", "<em>SHOULD NOT</em>", "<em>RECOMMENDED</em>", "<em>MAY</em>", and "<em>OPTIONAL</em>" in this
   document are to be interpreted as described in <a href="./rfc2119.html">RFC 2119</a> [<a href="./rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   In addition, the following terminology is used:

   CGA public key

          Public key used to generate the CGA according to <a href="./rfc3972.html">RFC 3972</a>
          [<a href="#ref-CGA" title='"Cryptographically Generated Addresses (CGA)"'>CGA</a>].

   CGA private key

          Private key corresponding to the CGA public key.

   Handover key encryption public key

          Public key generated by the MN and sent to the current AR to
          encrypt the shared handover key.

   Handover key encryption private key

          Private key corresponding to handover key encryption public
          key, held by the MN.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.%20%20Overview%20of%20the%20Protocol"></a></body></html><a class="selflink" href="#section-2" id="section-2">2</a>.  Overview of the Protocol</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.1.%20%20Brief%20Review%20of%20SEND"></a></body></html><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  Brief Review of SEND</span>

   SEND protects against a variety of threats to local link address
   resolution (also known as Neighbor Discovery) and last hop router
   (AR) discovery in IPv6 [<a href="./rfc3756.html" title='"IPv6 Neighbor Discovery (ND) Trust Models and Threats"'>RFC3756</a>].  These threats are not exclusive to
   wireless networks, but they generally are easier to mount on certain
   wireless networks because the link between the access point and MN
   can't be physically secured.



<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


   SEND utilizes CGAs in order to secure Neighbor Discovery signaling
   [<a href="#ref-CGA" title='"Cryptographically Generated Addresses (CGA)"'>CGA</a>].  Briefly, a CGA is formed by hashing together the IPv6 subnet
   prefix for a node's subnet, a random nonce, and an RSA public key,
   called the CGA public key.  The CGA private key is used to sign a
   Neighbor Advertisement (NA) message sent to resolve the link-layer
   address to the IPv6 address.  The combination of the CGA and the
   signature on the NA proves to a receiving node the sender's
   authorization to claim the address.  The node may opportunistically
   generate one or several keys specifically for SEND, or it may use a
   certified key that it distributes more widely.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.2.%20%20Protocol%20Overview"></a></body></html><a class="selflink" href="#section-2.2" id="section-2.2">2.2</a>.  Protocol Overview</span>

   The protocol utilizes the SEND secured Router Solicitation for Proxy
   Advertisement (RtSolPr)/Proxy Router Advertisement (PrRtAdv) [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>]
   exchange between the MN and the AR to transport an encrypted, shared
   handover key from the AR to the MN.  First, the MN generates the
   necessary key pair and associated CGA addresses so that the MN can
   employ SEND.  Then, the MN generates a public/private key pair for
   encrypting/decrypting the shared handover key, using the same public
   key algorithm as was used for SEND.  The MN then sends an RtSolPr
   message with a Handover Key Request Option containing the handover
   key encryption public key.  The source address of the RtSolPr message
   is the MN's care-of CGA on the AR's link, the RtSolPr message is
   signed with the MN's CGA key, and contains the CGA Parameters option,
   in accordance with <a href="./rfc3971.html">RFC 3971</a> [<a href="#ref-SEND" title='"SEcure Neighbor Discovery (SEND)"'>SEND</a>].  The AR verifies the message
   using SEND, then utilizes the handover key encryption public key to
   encrypt a shared handover key, which is included with the PrRtAdv in
   the Handover Key Reply Option.  The MN decrypts the shared handover
   key and uses it to establish an authorization MAC when it sends an
   FBU to the previous AR.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.%20%20Handover%20Key%20Provisioning%20and%20Use"></a></body></html><a class="selflink" href="#section-3" id="section-3">3</a>.  Handover Key Provisioning and Use</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.1.%20%20Sending%20Router%20Solicitations%20for%20Proxy%20Advertisement"></a></body></html><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Sending Router Solicitations for Proxy Advertisement</span>

   At some time prior to handover, the MN <em>MUST</em> generate a handover key
   encryption public/private key pair, using exactly the same public key
   algorithm with exactly the same parameters (key size, etc.) as for
   SEND [<a href="#ref-SEND" title='"SEcure Neighbor Discovery (SEND)"'>SEND</a>].  The MN can reuse the key pair on different access
   routers but <em>MUST NOT</em> use the key pair for any other encryption or for
   signature operation.  In order to prevent cryptanalysis, the key pair
   <em>SHOULD</em> be discarded after either a duration of HKEPK-LIFETIME or
   HKEPK-HANDOVERS number of handovers, whichever occurs first.  See
   <a href="#section-3.7">Section 3.7</a> for definitions of protocol constants.






<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


   The MN <em>MUST</em> send a Router Solicitation for Proxy Advertisement
   (RtSolPr) containing a Handover Key Request Option with the handover
   encryption public key.  A CGA for the MN <em>MUST</em> be the source address
   on the packet, and the MN <em>MUST</em> include the SEND CGA Option and SEND
   Signature Option with the packet, as specified in [<a href="#ref-SEND" title='"SEcure Neighbor Discovery (SEND)"'>SEND</a>].  The SEND
   signature covers all fields in the RtSolPr, including the 128-bit
   source and destination addresses and ICMP checksum as described in
   <a href="./rfc3971.html">RFC 3971</a>, except for the Signature Option itself.  The MN also sets
   the handover authentication Algorithm Type (AT) extension field in
   the Handover Key Request Option to the MN's preferred FBU
   authentication algorithm.  The SEND Nonce <em>MUST</em> also be included for
   anti-replay protection.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.2.%20%20Receiving%20Router%20Solicitations%20for%20Proxy%20Advertisement%20and%20Sending"></a></body></html><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Receiving Router Solicitations for Proxy Advertisement and Sending</span>
<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/%20%20%20%20%20%20Proxy%20Router%20Advertisements"></a></body></html>      Proxy Router Advertisements</span>

   When an FMIPv6 capable AR with SEND receives an RtSolPr from an MN
   protected with SEND and including a Handover Key Request Option, the
   AR <em>MUST</em> first validate the RtSolPr using SEND as described in <a href="./rfc3971.html">RFC</a>
   <a href="./rfc3971.html">3971</a>.  If the RtSolPr can not be validated, the AR <em>MUST NOT</em> include a
   Handover Key Reply Option in the reply.  The AR also <em>MUST NOT</em> change
   any existing key record for the address, since the message may be an
   attempt by an attacker to disrupt communications for a legitimate MN.
   The AR <em>SHOULD</em> respond to the RtSolPr but <em>MUST NOT</em> perform handover
   key provisioning.

   If the RtSolPr can be validated, the AR <em>MUST</em> then determine whether
   the CGA is already associated with a shared handover key.  If the CGA
   is associated with an existing handover key, the AR <em>MUST</em> return the
   existing handover key to the MN.  If the CGA does not have a shared
   handover key, the AR <em>MUST</em> construct a shared handover key as
   described in <a href="#section-3.6">Section 3.6</a>.  The AR <em>MUST</em> encrypt the handover key with
   the handover key encryption public key included in the Handover Key
   Request Option.  The AR <em>MUST</em> insert the encrypted handover key into a
   Handover Key Reply Option and <em>MUST</em> attach the Handover Key Reply
   Option to the PrRtAdv.  The lifetime of the key, HK-LIFETIME, <em>MUST</em>
   also be included in the Handover Key Reply Option.  The AR <em>SHOULD</em> set
   the AT field of the Handover Key Option to the MN's preferred
   algorithm type indicated in the AT field of the Handover Key Request
   Option, if it is supported; otherwise, the AR <em>MUST</em> select an
   authentication algorithm that is of equivalent strength or stronger,
   and set the field to that.  The AR <em>MUST</em> also include the SEND nonce
   from the RtSolPr for anti-replay protection.  The AR <em>MUST</em> have a
   certificate suitable for a SEND-capable router, support SEND
   certificate discovery, and include a SEND CGA Option and a SEND
   Signature Option in the PrRtAdv messages it sends.  Similarly, the
   mobile nodes <em>MUST</em> be configured with one or more SEND trust anchors
   so that they can verify these messages.  The SEND signature covers



<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


   all fields in the PrRtAdv, including the 128-bit source and
   destination addresses and ICMP checksum as described in <a href="./rfc3971.html">RFC 3971</a>,
   except for the Signature Option itself.  The PrRtAdv is then unicast
   back to the MN at the MN's care-of CGA that was the source address on
   the RtSolPr.  The handover key <em>MUST</em> be stored by the AR for future
   use, indexed by the CGA, and the authentication algorithm type (i.e.,
   the resolution of the AT field processing) and HK-LIFETIME <em>MUST</em> be
   recorded with the key.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.3.%20%20Receiving%20Proxy%20Router%20Advertisements"></a></body></html><a class="selflink" href="#section-3.3" id="section-3.3">3.3</a>.  Receiving Proxy Router Advertisements</span>

   Upon receipt of one or more PrRtAdvs secured with SEND and having the
   Handover Key Reply Option, the MN <em>MUST</em> first validate the PrRtAdvs as
   described in <a href="./rfc3971.html">RFC 3971</a>.  Normally, the MN will have obtained the
   router's certification path to validate an RA prior to sending the
   PrRtSol and the MN <em>MUST</em> check to ensure that the key used to sign the
   PrRtAdv is the router's certified public key.  If the MN does not
   have the router's certification path cached, it <em>MUST</em> use the SEND
   CPS/CPA messages to obtain the certification path to validate the
   key.  If a certified key from the router was not used to sign the
   message, the message <em>MUST</em> be dropped.

   From the messages that validate, the MN <em>SHOULD</em> choose one with an AT
   flag in the Handover Key Reply Option indicating an authentication
   algorithm that the MN supports.  From that message, the MN <em>MUST</em>
   determine which handover key encryption public key to use in the
   event the MN has more than one.  The MN finds the right public key to
   use by matching the SEND nonce from the RtSolPr.  If no such match
   occurs, the MN <em>MUST</em> drop the PrRtAdv.  The MN <em>MUST</em> use the matching
   private key to decrypt the handover key using its handover key
   encryption private key, and store the handover key for later use,
   named with the AR's CGA, along with the algorithm type and
   HK-LIFETIME.  The MN <em>MUST</em> use the returned algorithm type indicated
   in the PrRtAdv.  The MN <em>MUST</em> index the handover keys with the AR's
   IPv6 address, to which the MN later sends the FBU, and the MN's CGA
   to which the handover key applies.  This allows the MN to select the
   proper key when communicating with a previous AR.  Prior to
   HK-LIFETIME expiring, the MN <em>MUST</em> request a new key from the AR if
   FMIPv6 service is still required from the router.

   If more than one router responds to the RtSolPr, the MN <em>MAY</em> keep
   track of all such keys.  If none of the PrRtAdvs contains an
   algorithm type indicator corresponding to an algorithm the MN
   supports, the MN <em>MAY</em> re-send the RtSolPr requesting a different
   algorithm, but to prevent bidding down attacks from compromised
   routers, the MN <em>SHOULD NOT</em> request an algorithm that is weaker than
   its original request.




<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.4.%20%20Sending%20FBUs"></a></body></html><a class="selflink" href="#section-3.4" id="section-3.4">3.4</a>.  Sending FBUs</span>

   When the MN needs to signal the Previous AR (PAR) using an FMIPv6
   FBU, the MN <em>MUST</em> utilize the handover key and the corresponding
   authentication algorithm to generate an authenticator for the
   message.  The MN <em>MUST</em> select the appropriate key for the PAR using
   the PAR's CGA and the MN's previous care-of CGA on the PAR's link.
   As defined by the FMIPv6 [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>], the MN <em>MUST</em> generate the
   authentication MAC using the handover key and the appropriate
   algorithm and <em>MUST</em> include the MAC in the FBU message.  As specified
   by FMIPv6, the MN <em>MUST</em> include the old care-of CGA in a Home Address
   Option.  The FMIPv6 document provides more detail about the
   construction of the authenticator on the FBU.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.5.%20%20Receiving%20FBUs"></a></body></html><a class="selflink" href="#section-3.5" id="section-3.5">3.5</a>.  Receiving FBUs</span>

   When the PAR receives an FBU message containing an authenticator, the
   PAR <em>MUST</em> find the corresponding handover key using the MN's care-of
   CGA in the Home Address Option as the index.  If a handover key is
   found, the PAR <em>MUST</em> utilize the handover key and the appropriate
   algorithm to verify the authenticator.  If the handover key is not
   found, the PAR <em>MUST NOT</em> change forwarding for the care-of CGA.  The
   FMIPv6 document [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>] provides more detail on how the AR processes
   an FBU containing an authenticator.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.6.%20%20Key%20Generation%20and%20Lifetime"></a></body></html><a class="selflink" href="#section-3.6" id="section-3.6">3.6</a>.  Key Generation and Lifetime</span>

   The AR <em>MUST</em> randomly generate a key having sufficient strength to
   match the authentication algorithm.  Some authentication algorithms
   specify a required key size.  The AR <em>MUST</em> generate a unique key for
   each CGA public key, and <em>SHOULD</em> take care that the key generation is
   uncorrelated between handover keys, and between handover keys and CGA
   keys.  The actual algorithm used to generate the key is not important
   for interoperability since only the AR generates the key; the MN
   simply uses it.

   A PAR <em>SHOULD NOT</em> discard the handover key immediately after use if it
   is still valid.  It is possible that the MN may undergo rapid
   movement to another AR prior to the completion of Mobile IPv6 binding
   update on the PAR, and the MN <em>MAY</em> as a consequence initialize
   another, subsequent handover optimization to move traffic from the
   PAR to another new AR.  The default time for keeping the key valid
   corresponds to the default time during which forwarding from the PAR
   to the new AR is performed for FMIP.  The FMIPv6 document [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>]
   provides more detail about the FMIP forwarding time default.

   If the MN returns to a PAR prior to the expiration of the handover
   key, the PAR <em>MAY</em> send and the MN <em>MAY</em> receive the same handover key as



<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


   was previously returned, if the MN generates the same CGA for its
   Care-of Address.  However, the MN <em>MUST NOT</em> assume that it can
   continue to use the old key without actually receiving the handover
   key again from the PAR.  The MN <em>SHOULD</em> discard the handover key after
   MIPv6 binding update is complete on the new AR.  The PAR <em>MUST</em> discard
   the key after FMIPv6 forwarding for the previous Care-of Address
   times out or when HK-LIFETIME expires.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.7.%20%20Protocol%20Constants"></a></body></html><a class="selflink" href="#section-3.7" id="section-3.7">3.7</a>.  Protocol Constants</span>

   The following are protocol constants with suggested defaults:

   HKEPK-LIFETIME:   The maximum lifetime for the handover key
                     encryption public key.  Default is 12 hours.

   HKEPK-HANDOVERS:  The maximum number of handovers for which the
                     handover key encryption public key should be
                     reused.  Default is 10.

   HK-LIFETIME:      The maximum lifetime for the handover key.  Default
                     is 12 hours (43200 seconds).

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/4.%20%20Message%20Formats"></a></body></html><a class="selflink" href="#section-4" id="section-4">4</a>.  Message Formats</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/4.1.%20%20Handover%20Key%20Request%20Option"></a></body></html><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Handover Key Request Option</span>

   The Handover Key Request Option is a standard IPv6 Neighbor Discovery
   [<a href="./rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] option in TLV format.  The Handover Key Request Option is
   included in the RtSolPr message along with the SEND CGA Option, RSA
   Signature Option, and Nonce Option.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |    Length     |  Pad Length   |  AT   |Resrvd.|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                                                               .
   .              Handover Key Encryption Public Key               .
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                                                               .
   .                           Padding                             .
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+



<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>



   Fields:

      Type:          27

      Length:        The length of the option in units of 8 octets,
                     including the Type and Length fields.  The value 0
                     is invalid.  The receiver <em>MUST</em> discard a message
                     that contains this value.

      Pad Length:    The number of padding octets beyond the end of the
                     Handover Key Encryption Public Key field but within
                     the length specified by the Length field.  Padding
                     octets <em>MUST</em> be set to zero by senders and ignored
                     by receivers.

      AT:            A 4-bit algorithm type field describing the
                     algorithm used by FMIPv6 to calculate the
                     authenticator.  See [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>] for details.

      Resrvd.:       A 4-bit field reserved for future use.  The value
                     <em>MUST</em> be initialized to zero by the sender and <em>MUST</em>
                     be ignored by the receiver.

      Handover Key Encryption Public Key:
                     The handover key encryption public key.  The key
                     <em>MUST</em> be formatted according to the same
                     specification as the CGA key in the CGA Parameters
                     Option [<a href="#ref-CGA" title='"Cryptographically Generated Addresses (CGA)"'>CGA</a>] of the message, and <em>MUST</em> have the same
                     parameters as the CGA key.

      Padding:       A variable-length field making the option length a
                     multiple of 8, containing as many octets as
                     specified in the Pad Length field.

















<span class="grey">Kempf &amp; Koodli              Standards Track                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/4.2.%20%20Handover%20Key%20Reply%20Option"></a></body></html><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Handover Key Reply Option</span>

   The Handover Key Reply Option is a standard IPv6 Neighbor Discovery
   [<a href="./rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] option in TLV format.  The Handover Key Reply Option is
   included in the PrRtAdv message along with the SEND CGA Option, RSA
   Signature Option, and Nonce Option.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |    Length     |  Pad Length   |  AT   |Resrvd.|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Key Lifetime        |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                                                               |
   .                                                               .
   .                    Encrypted Handover Key                     .
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                                                               .
   .                           Padding                             .
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Fields:

      Type:          28

      Length:        The length of the option in units of 8 octets,
                     including the Type and Length fields.  The value 0
                     is invalid.  The receiver <em>MUST</em> discard a message
                     that contains this value.

      Pad Length:    The number of padding octets beyond the end of the
                     Encrypted Handover Key field but within the length
                     specified by the Length field.  Padding octets <em>MUST</em>
                     be set to zero by senders and ignored by receivers.

      AT:            A 4-bit algorithm type field describing the
                     algorithm used by FMIPv6 to calculate the
                     authenticator.  See [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>] for details.






<span class="grey">Kempf &amp; Koodli              Standards Track                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


      Resrvd.:       A 4-bit field reserved for future use.  The value
                     <em>MUST</em> be initialized to zero by the sender and <em>MUST</em>
                     be ignored by the receiver.

      Key Lifetime:  Lifetime of the handover key, HK-LIFETIME, in
                     seconds.

      Encrypted Handover Key:
                     The shared handover key, encrypted with the MN's
                     handover key encryption public key, using the
                     RSAES-PKCS1-v1_5 format [<a href="./rfc3447.html" title='"Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1"'>RFC3447</a>].

      Padding:       A variable-length field making the option length a
                     multiple of 8, containing as many octets as
                     specified in the Pad Length field.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/5.%20%20Security%20Considerations"></a></body></html><a class="selflink" href="#section-5" id="section-5">5</a>.  Security Considerations</span>

   This document describes a shared key provisioning protocol for the
   FMIPv6 handover optimization protocol.  The key provisioning protocol
   utilizes a public key generated with the same public key algorithm as
   SEND to bootstrap a shared key for authorizing changes due to
   handover associated with the MN's former address on the PAR.  General
   security considerations involving CGAs apply to the protocol
   described in this document, see [<a href="#ref-CGA" title='"Cryptographically Generated Addresses (CGA)"'>CGA</a>] for a discussion of security
   considerations around CGAs.  This protocol is subject to the same
   risks from replay attacks and denial-of-service (DoS) attacks using
   the RtSolPr as the SEND protocol [<a href="#ref-SEND" title='"SEcure Neighbor Discovery (SEND)"'>SEND</a>] for RS.  The measures
   recommended in <a href="./rfc3971.html">RFC 3971</a> for mitigating replay attacks and DoS attacks
   apply here as well.  An additional consideration involves when to
   generate the handover key on the AR.  To avoid state depletion
   attacks, the handover key <em>SHOULD NOT</em> be generated prior to SEND
   processing that verifies the originator of RtSolPr.  State depletion
   attacks can be addressed by techniques, such as rate limiting
   RtSolPr, restricting the amount of state reserved for unresolved
   solicitations, and clever cache management.  These techniques are the
   same as used in implementing Neighbor Discovery.

   For other FMIPv6 security considerations, please see the FMIPv6
   document [<a href="#ref-FMIP" title='"Mobile IPv6 Fast Handovers"'>FMIP</a>].

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/6.%20%20IANA%20Considerations"></a></body></html><a class="selflink" href="#section-6" id="section-6">6</a>.  IANA Considerations</span>

   IANA has assigned IPv6 Neighbor Discovery option type codes for the
   two new IPv6 Neighbor Discovery options, the Handover Key Request
   Option (27) and Handover Key Reply Option (28), defined in this
   document.




<span class="grey">Kempf &amp; Koodli              Standards Track                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.%20%20References"></a></body></html><a class="selflink" href="#section-7" id="section-7">7</a>.  References</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.1.%20%20Normative%20References"></a></body></html><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-FMIP">FMIP</a>]    Koodli, R., Ed., "Mobile IPv6 Fast Handovers", <a href="./rfc5268.html">RFC 5268</a>,
             June 2008.

   [<a id="ref-SEND">SEND</a>]    Arkko, J., Ed., Kempf, J., Zill, B., and P. Nikander,
             "SEcure Neighbor Discovery (SEND)", <a href="./rfc3971.html">RFC 3971</a>, March 2005.

   [<a id="ref-CGA">CGA</a>]     Aura, T., "Cryptographically Generated Addresses (CGA)",
             <a href="./rfc3972.html">RFC 3972</a>, March 2005.

   [<a id="ref-RFC2119">RFC2119</a>] Bradner, S., "Key words for use in RFCs to Indicate
             Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC4861">RFC4861</a>] Narten, T., Nordmark, E., Simpson, W., and H. Soliman,
             "Neighbor Discovery for IP version 6 (IPv6)", <a href="./rfc4861.html">RFC 4861</a>,
             September 2007.

   [<a id="ref-RFC3447">RFC3447</a>] Jonsson, J. and B. Kaliski, "Public-Key Cryptography
             Standards (PKCS) #1: RSA Cryptography Specifications
             Version 2.1", <a href="./rfc3447.html">RFC 3447</a>, February 2003.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.2.%20%20Informative%20References"></a></body></html><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-RFC3756">RFC3756</a>] Nikander, P., Ed., Kempf, J., and E. Nordmark, "IPv6
             Neighbor Discovery (ND) Trust Models and Threats", <a href="./rfc3756.html">RFC</a>
             <a href="./rfc3756.html">3756</a>, May 2004.

   [<a id="ref-PBK">PBK</a>]     Bradner, S., Mankin, A., and Schiller, J., "A Framework for
             Purpose-Built Keys (PBK)", Work in Progress, June 2003.
             Progress.


















<span class="grey">Kempf &amp; Koodli              Standards Track                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


Authors' Addresses

   James Kempf
   DoCoMo Labs USA
   3240 Hillview Avenue
   Palo Alto, CA 94303
   USA

   Phone: +1 650 496 4711
   EMail: kempf@docomolabs-usa.com

   Rajeev Koodli
   Starent Networks
   30 International Place
   Tewksbury, MA  01876
   USA

   Phone: +1 408 735 7679
   EMail: rkoodli@starentnetworks.com
































<span class="grey">Kempf &amp; Koodli              Standards Track                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc5269.html">RFC 5269</a>                     FMIP Security                     June 2008</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and <a href="https://www.rfc-editor.org/bcp/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Kempf &amp; Koodli              Standards Track                    [Page 14]
</pre>
</body>
</html>
